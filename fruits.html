<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreshCart - Your Online Grocery Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <header class="site-header">
        <div class="container">
            <h1 class="site-logo">GROCIFY</h1>
            <nav class="main-nav">
                <ul>
                    <li><i class="fa-solid fa-house"></i> <a href="#home">Home</a></li>
                    <li><i class="fa-solid fa-truck"></i> <a href="#products">Products</a></li>
                    <li><i class="fa-solid fa-circle-info"></i> <a href="#about">About</a></li>
                    <li><i class="fa-solid fa-address-book"></i> <a href="#contact">Contact</a></li>
                    <li class="cart-icon"><i class="fa-solid fa-cart-shopping"></i> <a href="#" onclick="showCart()">Cart</a><span id="cart-item-count">0</span></li>
                </ul>
            </nav>
        </div>
        <div class="scrolling-banner-container">
            <div class="scrolling-text">
                ü•≥ü•≥ Flat 50% OFF on All PRODUCTS! üéâüéâ ü§©Buy 3kg anything and get 1kg freeü§©, Free Delivery on orders Above rs. 300, get up to 80% of on your first order ü•≥üéâ enjoy bumper sales and offers ‚ù§Ô∏è‚ù§Ô∏è lets start and shop now ü§© ü§©!!!!!
            </div>
        </div>
    </header>

    <main>
        <section id="home" class="hero">
            <div class="hero-content">
                <h2>Fresh Groceries, Delivered to You</h2>
                <p>The best quality products from local farms, right at your doorstep.</p>
                <a href="#products" class="btn btn-shop-now">Shop Now</a>
            </div>
        </section>


        <section id="products" class="featured-products">
            <div class="container">
                <h2 class="section-title">Our Featured Products</h2>
                
                <div class="product-grid">

                    <div class="product-card" data-id="1">
                        <img src="/static/images/mangoes.jpeg" alt="Fresh Mangoes">
                        <h3>Mangoes</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">60</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                    <div class="product-card" data-id="2">
                        <img src="/static/images/oranges.jpeg" alt="Fresh Oranges">
                        <h3>Oranges</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">60</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                    <div class="product-card" data-id="3">
                        <img src="/static/images/banana.jpeg" alt="Fresh Bananas">
                        <h3>Bananas</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">30</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                    <div class="product-card" data-id="4">
                        <img src="/static/images/kiwi.jpeg" alt="Fresh Kiwi">
                        <h3>Kiwi</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">100</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                    <div class="product-card" data-id="5">
                        <img src="/static/images/papaya.jpeg" alt="Fresh Papaya">
                        <h3>Papaya</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">30</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                    <div class="product-card" data-id="6">
                        <img src="/static/images/pomegranate.jpeg" alt="Fresh Pomegranate">
                        <h3>Pomegranate</h3>
                        <div class="quantity-controls">
                            <button onclick="decrease(this)">-</button>
                            <span class="quantity">0</span> kg
                            <button onclick="increase(this)">+</button>
                        </div>
                        <p class="price">Unit Price: Rs. <span class="unit-price">60</span></p>
                        <p class="price">Total: Rs. <span class="total-price">0</span></p>
                        <button class="btn btn-secondary" onclick="addToCartFromCard(this)">Add to Cart</button>
                    </div>

                </div>
            </div>
        </section>

        <section id="about" class="about-us">
            <div class="container">
                <h2 class="section-title">Why Choose GROCIFY?</h2>
                <p>We are committed to bringing you the freshest, highest-quality groceries. We partner with local farmers and producers to ensure every item meets our strict standards for quality and sustainability. Shop with us and taste the difference.</p>
            </div>
        </section>
    </main>

    <footer id="contact" class="site-footer">
        <div class="container">
            <div class="social-links">
                <ul>
                    <li><a href="#">Facebook</a> <i class="fa-brands fa-facebook"></i></li>
                    <li><a href="#">Instagram</a> <i class="fa-brands fa-instagram"></i></li>
                    <li><a href="#">Twitter</a> <i class="fa-brands fa-twitter"></i></li>
                </ul>
            </div>
        </div>
    </footer>

    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="hideCart()">&times;</span>
            <h2>Your Shopping Cart</h2>
            <ul id="cart-items">
                </ul>
            <div class="cart-summary">
                <p>Total: Rs. <span id="cart-total-price">0</span></p>
                <button class="btn btn-primary" onclick="placeOrder()">Place Order</button>
            </div>
        </div>
    </div>

    <script>
        // ------------------ LOCAL QUANTITY FUNCTIONS (Used on Product Cards) ------------------
        function increase(button) {
            const card = button.closest(".product-card");
            const quantityEl = card.querySelector(".quantity");
            const unitPrice = parseInt(card.querySelector(".unit-price").textContent);
            const totalPriceEl = card.querySelector(".total-price");

            let quantity = parseInt(quantityEl.textContent);
            quantity++;
            quantityEl.textContent = quantity;
            totalPriceEl.textContent = quantity * unitPrice;
        }

        function decrease(button) {
            const card = button.closest(".product-card");
            const quantityEl = card.querySelector(".quantity");
            const unitPrice = parseInt(card.querySelector(".unit-price").textContent);
            const totalPriceEl = card.querySelector(".total-price");

            let quantity = parseInt(quantityEl.textContent);
            if (quantity > 0) {
                quantity--;
                quantityEl.textContent = quantity;
                totalPriceEl.textContent = quantity * unitPrice;
            }
        }
        
        // ------------------ GLOBAL CART FUNCTIONS ------------------
        let cart = [];

        function addToCartFromCard(button) {
            const card = button.closest(".product-card");
            const id = parseInt(card.getAttribute('data-id'));
            const name = card.querySelector('h3').textContent;
            const price = parseInt(card.querySelector(".unit-price").textContent);
            const quantity = parseInt(card.querySelector(".quantity").textContent);
            
            if (quantity > 0) {
                const existingProduct = cart.find(item => item.id === id);

                if (existingProduct) {
                    existingProduct.quantity += quantity;
                } else {
                    cart.push({ id, name, price, quantity });
                }
                
                // Reset local card quantity after adding to cart
                card.querySelector(".quantity").textContent = 0;
                card.querySelector(".total-price").textContent = 0;

                updateCartDisplay();
                showCart(); // Show the cart immediately
            } else {
                alert("Please select a quantity greater than zero.");
            }
        }

        function updateCartDisplay() {
            const cartItemsList = document.getElementById('cart-items');
            cartItemsList.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div class="cart-item-info">
                        <span>${item.name}</span>
                        <div class="cart-item-controls">
                            <button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button>
                            <span class="item-quantity">${item.quantity}</span>
                            <button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button>
                        </div>
                    </div>
                    <div class="cart-item-price">
                        <span>Rs. ${item.price * item.quantity}</span>
                        <button class="remove-btn" onclick="removeItem(${item.id})">Remove</button>
                    </div>
                `;
                cartItemsList.appendChild(listItem);
                total += item.price * item.quantity;
            });

            document.getElementById('cart-total-price').textContent = total;
            // Update cart item count badge
            const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-item-count').textContent = cartItemCount;
            
            // Show empty cart message if needed
            if (cart.length === 0) {
                cartItemsList.innerHTML = '<p style="text-align: center; padding: 20px;">Your cart is empty.</p>';
            }
        }

        function increaseQuantity(id) {
            const item = cart.find(product => product.id === id);
            if (item) {
                item.quantity++;
                updateCartDisplay();
            }
        }

        function decreaseQuantity(id) {
            const item = cart.find(product => product.id === id);
            if (item && item.quantity > 1) {
                item.quantity--;
                updateCartDisplay();
            } else {
                removeItem(id);
            }
        }

        function removeItem(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartDisplay();
        }

        function showCart() {
            document.getElementById('cart-modal').style.display = 'block';
            updateCartDisplay(); // Ensure cart is up-to-date when shown
        }

        function hideCart() {
            document.getElementById('cart-modal').style.display = 'none';
        }

        // UPDATED function to redirect to placeorder.html
        function placeOrder() {
            if (cart.length > 0) {
                // 1. Calculate Total Price
                const total = document.getElementById('cart-total-price').textContent;
                
                // 2. Encode the cart data into a JSON string
                const cartData = encodeURIComponent(JSON.stringify(cart));

                // 3. Redirect to the place order page, passing data in the URL
                window.location.href = `placeorder.html?cart=${cartData}&total=${total}`;

                // IMPORTANT: We do NOT clear the cart here. We'll let the user finalize the order on the next page.
                hideCart(); 
            } else {
                alert("Your cart is empty. Please add items to place an order.");
            }
        }
    </script>
</body>
</html>
